<?php  $accountsFriends = $this->accounts; ?>
<?php  $accounts = $this->accounts; ?>
<?php  $allactivity = $this->results; ?>
<?php  $usernamesTemp = $this->usernames; ?>
<?php  $imgPrefix = $this->imgPrefix; ?>
<?php  $seriesColor = array("#FF9900", "#00F"); ?>
<?php 
	$sum=0;
	foreach ($this->allActivity as $activityTemp){
	$sum = $sum +  (1*$activityTemp->glass)+(2*$activityTemp->plastic)+(3*$activityTemp->aluminium);
}?>
<div class="row-fluid userContent">
	<div class="span3">
		<div id="profile-points" class="row-fluid">
			<div class="span11">
				<div class="profile-points text-right">
					<span><?php echo $sum;?></span>
				</div>
			</div>
			<div class="span11">
				<div class="profile-points text-right">
					<span>total leaves<br>saved</span>
				</div>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span11" id="friends">
				
				<h5 class="hidden">Explore Users</h5>
				<?php $counter=0; 
				$mostPoints = 0;
				?>
				<?php  foreach ($accountsFriends as $account) { ?>
				<?php if ($counter==0) $mostPoints = $account->quantity; ?>
					<div class="span2 friends">
						  <a class="thumbnail" title="<?php echo $account->username; ?>" href="<?php echo $this->baseUrl('account/profile/').'?user='.$account->username;?>">
						    <span class="right visible-phone"><?php echo $account->username; ?></span>
						    <img class="media-object" src="<?php echo $this->baseUrl($imgPrefix."thumb-".$account->avatar); ?>">
						  </a>
						<?php //if ($counter==0) { echo '<span class="left label label-info newMember">New!</span>'; }
						//elseif ($account->quantity>0.8*$mostPoints) {  echo '<span class="left label label-success newMember"><i class="icon-leaf icon-white"></i></span>';}?>
					</div>
				 <?php 
				 $counter++; 
			} ?>	
			</div>
		</div>
		<div class="row-fluid">
			<div class="span11" id="twitterTable">
				<h5 class="hidden">Tweet!Tweet!</h5>
				<?php $this->tweets(); ?>
			</div>
		</div>
	</div>
	
	<div class="span8">
		<div class="row-fluid ">
			<ul class="nav nav-pills">
				<li class="active"><a data-toggle="tab" href="#Diagram">Diagram</a></li>
			  	<li><a  data-toggle="tab" href="#Activity">Activity</a></li>
		        <li><a  data-toggle="tab" href="#Barchart">Barchart</a></li> 
			</ul>
            <div id="myTabContent" class="tab-content">
				
				<!-- Diagram Content -->
            	<div class="tab-pane fade active in" id="Diagram">
            		<h4>Check the progress of our users - Activity over time</h4>
    					<div id="chartdiv"></div>
    					<?php // foreach($this->paginator as $record)
					    //{
					     //   echo $record['email'].'\n';
					    //}
					    //echo $this->paginationControl($this->paginator, 'Sliding', 'pagination.phtml');
					    ?>
					    <div id="diagramUserNamesPanel" class="row-fluid">
					    	<div class="span8 ">
					    	<ul>
					    		<?php 
					    			$colorCounter = 0;
					    			foreach ($accounts as $account){
										echo "<li><span style='background-color:".$seriesColor[$colorCounter]."'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>".$account->fullname."</span></li>";
										$colorCounter++;
									}
					    		?>
					    	</ul>
					    	</div>
					    </div>
              	</div>
              	
				<!-- Activity Content -->
				<div class="tab-pane fade" id="Activity">
				
				
					
				<!-- Activity Container -->
					<h4>Latest recycling!</h4>
					<table class="table table-hover table-stripped">
					<?php  foreach ( $allactivity as $activity) { ?>
					<!--  <div class="media">
	                    <a class="pull-left" href="<?php echo $this->baseUrl('account/profile/').'?user='.$activity->username;?>">
	                    <img class="media-object" src="http://placehold.it/64x64">
	                    </a>
						<div class="media-body">
	    					<h4 class="media-heading"><?php echo $activity->username;  ?></h4>
	    					 just saved <?php echo $activity->quantity;?>
	    				</div>
	
					</div> 
					-->
						<?php if ($activity->quantity>0) {?>
						<tr>
							<td>
								<a class="pull-left" href="<?php echo $this->baseUrl('account/profile/').'?user='.$activity->username;?>">
	                    			<img class="media-object thumbnail" src="<?php echo $this->baseUrl($imgPrefix."thumb-".$activity->avatar);?>">
	                    		</a>
							</td>
							<td>
								<?php echo ucfirst($activity->username);  ?> saved <?php echo 1*$activity->glass+2*$activity->plastic+3*$activity->aluminium; ?> leafs on <?php echo date("d-M",strtotime($activity->date)) ?>! <span class="muted">(aluminium: <?php echo $activity->aluminium.", plastic:".$activity->plastic.", glass:".$activity->glass ?>)</span>
							</td>
						</tr>
					
						<?php } ?>
					<?php } ?>
					</table>
					<span class="pull-left"><?php echo $this->paginationControl($this->results, 'Sliding', 'pagination.phtml'); ?></span>
	
				</div>            
            
            	
              	<!-- Barchart Content -->
              
				<div class="tab-pane fade well" id="Barchart">
				
				<!-- BarChart Container -->
				<?php $place = 1;?>
					<div>
	                <?php  foreach ($accounts as $account) { ?>
	                    <div class="row-fluid">
	                    	<div class="barChartDetails"><img src='<?php echo $this->baseUrl("images/numbers/".$place.".png"); ?>'>&nbsp;&nbsp;&nbsp;<span class="ladderName"><?php echo $account->fullname; ?></span><br><span class="ladderPoints"><?php echo $account->quantity;?> points</span></div>
		                   	<div class="progress">
			  					<div class="bar" style="width: <?php echo ($account->quantity/$mostPoints)*100 ?>%;"></div>
							</div>
						</div>
					<?php $place++; } ?>
					</div>
				</div>
			 	
            </div>
		</div>	
	</div>
</div>
<script>
<?php 

	$count=1;
	$lines = "[";
	foreach ($this->activity as $act) {
		echo "var line".$count."=".str_replace('"', "", $act).";";
		//echo "<br>";
		$lines.= " line".$count.",";
		$count++;
	}
	$lines = rtrim($lines, ",");
	$lines.="]";
	

	$usernames = "[";
	foreach ($usernamesTemp as $usr) {
		$usernames.='"'.$usr.'",';
	}
	$usernames = rtrim($usernames, ",");
	$usernames.="]"; 

	$ticks = "[";
	$i = 1;
	foreach ($this->dates as $date){
		$ticks.='['.$i.',"'.date("d-M", strtotime($date)).'"],';
		$i++;
	}
	$ticks = rtrim($ticks,",");
	$ticks.="]";
?>
var labels = <?php echo $usernames; ?>;
var ticks = <?php echo $ticks; ?>; 
var plot1 = $.jqplot('chartdiv', <?php echo $lines ?>, {
	  animate: true,
      // Will animate plot on calls to plot1.replot({resetAxes:true})
      animateReplot: false, 
      seriesColors:<?php echo json_encode($seriesColor); ?>,
   	 seriesDefaults: { 
      showMarker:true,
      pointLabels: { 
          show:false },
      rendererOptions: {smooth: true} 
    },
    legend: {
        show: false,
        renderer: $.jqplot.EnhancedLegendRenderer,
        placement: "insideGrid",
        labels: labels,
        location: "ne",
        rowSpacing: "1px",
        seriesToggle : 'normal',
        showSwatches : true,
        showLabels: false
    },
    highlighter: {
        show: false,
        sizeAdjust: 7.5,
        bringSeriesToFront: false
    },	
    grid: {
        drawGridLines: true},
    axes: {
        xaxis: {
        	labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
        	tickRenderer: $.jqplot.CanvasAxisTickRenderer,
            pad: 1,
            tickOptions: {
                showGridline: true,
                angle: -30
            },
            ticks: ticks
        },
        yaxis: {
        	labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
            min: 0,
            //max: 100,
            //label: 'Points',
            tickOptions: {
              showGridline: true//,
            //  suffix: '%'
            }
        }
    }
});
</script>
